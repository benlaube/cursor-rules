---
description: Next.js project structure and App Router patterns. This rule covers directory organization, route handling, layouts, loading states, and error boundaries. Agents must follow Next.js conventions, use proper file naming, implement layouts and loading states, and structure projects for maintainability.
version: 1.0.0
created: 12-08-2025
lastUpdated: 12-08-2025 10:00:00 EST
alwaysApply: false
globs: **/app/**,**/pages/**,next.config.*
type: Tech Stack Rule - Next.js structure
applicability: Next.js projects
dependencies: []
relatedCommands: []
relatedRules: [[nextjs-data-fetching.mdc], [nextjs-api-routes.mdc], [../react/react-components.mdc]]
relatedStandards: []
---

# Next.js Structure Rule

## When This Rule Applies

This rule applies when:
- Setting up Next.js projects
- Creating routes and pages
- Organizing Next.js code
- Implementing layouts and error handling

---

## App Router Structure

```
app/
  layout.tsx           # Root layout
  page.tsx             # Home page (/)
  loading.tsx          # Loading UI
  error.tsx            # Error boundary
  not-found.tsx        # 404 page
  
  (auth)/              # Route group (no URL segment)
    login/
      page.tsx         # /login
    register/
      page.tsx         # /register
    layout.tsx         # Auth layout
  
  dashboard/
    layout.tsx         # Dashboard layout
    page.tsx           # /dashboard
    settings/
      page.tsx         # /dashboard/settings
    [userId]/          # Dynamic route
      page.tsx         # /dashboard/:userId
  
  api/
    users/
      route.ts         # API route
    webhooks/
      stripe/
        route.ts       # /api/webhooks/stripe

components/            # Shared components
  ui/                  # UI primitives
  forms/               # Form components
  layouts/             # Layout components

lib/                   # Utilities
  db.ts
  auth.ts
  utils.ts
```

---

## Special Files

### layout.tsx

```tsx
// app/layout.tsx (Root Layout)
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        <Providers>
          <Header />
          <main>{children}</main>
          <Footer />
        </Providers>
      </body>
    </html>
  );
}
```

### loading.tsx

```tsx
// app/dashboard/loading.tsx
export default function DashboardLoading() {
  return (
    <div className="animate-pulse">
      <div className="h-8 bg-gray-200 rounded w-1/4 mb-4" />
      <div className="h-64 bg-gray-200 rounded" />
    </div>
  );
}
```

### error.tsx

```tsx
'use client';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <div className="error-container">
      <h2>Something went wrong!</h2>
      <button onClick={reset}>Try again</button>
    </div>
  );
}
```

### not-found.tsx

```tsx
export default function NotFound() {
  return (
    <div className="not-found">
      <h2>Page Not Found</h2>
      <Link href="/">Return Home</Link>
    </div>
  );
}
```

---

## Route Groups

```
app/
  (marketing)/         # Marketing pages
    page.tsx           # /
    about/
      page.tsx         # /about
    layout.tsx         # Marketing layout
  
  (app)/               # App pages
    dashboard/
      page.tsx         # /dashboard
    layout.tsx         # App layout (with sidebar)
```

---

## Dynamic Routes

```
app/
  blog/
    [slug]/            # /blog/:slug
      page.tsx
    [...slug]/         # /blog/* (catch-all)
      page.tsx
    [[...slug]]/       # /blog/* (optional catch-all)
      page.tsx
```

```tsx
// app/blog/[slug]/page.tsx
interface PageProps {
  params: { slug: string };
  searchParams: { [key: string]: string | string[] | undefined };
}

export default function BlogPost({ params, searchParams }: PageProps) {
  return <article>{params.slug}</article>;
}

// Generate static paths
export async function generateStaticParams() {
  const posts = await getPosts();
  return posts.map((post) => ({ slug: post.slug }));
}
```

---

## Metadata

```tsx
// Static metadata
export const metadata = {
  title: 'My App',
  description: 'My app description',
};

// Dynamic metadata
export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
  const post = await getPost(params.slug);
  return {
    title: post.title,
    description: post.excerpt,
    openGraph: {
      title: post.title,
      images: [post.image],
    },
  };
}
```

---

## Anti-Patterns to Avoid

- ❌ Business logic in page components
- ❌ Missing loading/error states
- ❌ Not using route groups for layouts
- ❌ Inconsistent file naming
- ❌ No metadata on pages

---

## Checklist

- [ ] App Router structure followed
- [ ] Loading states implemented
- [ ] Error boundaries added
- [ ] Route groups for different layouts
- [ ] Metadata on all pages
- [ ] Components outside app/ directory

---

## Related Files

- **Rules:**
  - [nextjs-data-fetching.mdc](./nextjs-data-fetching.mdc) - Data fetching
  - [nextjs-api-routes.mdc](./nextjs-api-routes.mdc) - API routes
  - [../react/react-components.mdc](../react/react-components.mdc) - React patterns
