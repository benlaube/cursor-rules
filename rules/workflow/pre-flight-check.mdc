---
description: Auto-applied rule that validates environment and repository state before starting any coding task. This rule includes git hooks verification, dependency checks, environment configuration validation, and baseline integrity checks (tests, build, linter). Agents must verify git status is clean and synced, check dependencies are installed, ensure environment is configured (.env present), validate baseline tests and build pass, and abort if critical issues are found before proceeding with coding work.
version: 2.3.0
created: 12-04-2025
lastUpdated: 12-08-2025 10:00:00 EST
alwaysApply: false
globs:
type: Workflow Integration Rule - Pre-flight validation before coding
applicability: Before starting any coding task
dependencies: []
relatedCommands: []
relatedRules: [[task-workflow.mdc], [auto-heal.mdc], [linting-behavior.mdc], [../git/git-workflow-integration.mdc], [../git/git-branch-naming.mdc]]
relatedStandards: [[process/code-quality-linting-standards.md]]
---

# Pre-Flight Check Rule

## When This Rule Applies

This rule **automatically applies** when:
- Starting a new task or feature
- Beginning significant code changes
- The agent detects this is the start of a work session

---

## Core Principle

**Never start coding in a broken environment.** Before making changes, the agent MUST validate:
1. Git status is clean and synced
2. Dependencies are installed
3. Environment is configured
4. Baseline tests and build pass

**Source Checklist:** `standards/process/checklists/pre_flight_checklist.md`

---

## Visual Workflow

```mermaid
flowchart TD
    Start([Start work]) --> Branch[Check current branch\n not main/master]
    Branch --> Tree[Check working tree\n git status --porcelain]
    Tree --> Sync[Fetch & compare with origin/main]
    Sync --> Hooks[Verify git hooks\n husky + commitlint]
    Hooks --> Deps[Check dependencies installed\n node_modules/.venv]
    Deps --> Config[Verify .env/.env.local present]
    Config --> Secrets[Ensure .env not tracked\n& secrets not staged]
    Secrets --> Baseline[Baseline integrity\n tests, build, lint]
    Baseline -->|pass| Ready([Ready to code])
    Baseline -->|fail| Fix[Auto-heal / fix blockers]
    Fix --> Branch
```

## Agent Responsibilities

### 1. Git Status Validation

**Before starting work, verify git state:**

1. **Check Current Branch:**
   - Get current branch: `git branch --show-current`
   - If on `main` or `master`: ⚠️ Warn about working on main branch
   - Suggest creating feature branch if needed

2. **Check Working Tree:**
   - Run: `git status --porcelain`
   - If uncommitted changes exist: ⚠️ Warn about dirty working tree
   - If clean: ✅ Proceed

3. **Sync with Remote:**
   - Check if behind: `git fetch origin && git rev-list HEAD..origin/main --count`
   - If behind: ⚠️ Warn about being out of sync
   - If up to date: ✅ Proceed

### 2. Environment Validation

**Verify environment is ready:**

1. **Git Hooks Check:**
   - **Check if Husky is configured:**
     - Verify `.husky/` directory exists
     - Verify `.husky/pre-commit` and `.husky/commit-msg` exist
     - Check hooks are executable
   - **If missing:** Auto-run `setup-git-hooks` command
   - ✅ Git hooks configured

2. **Dependencies Check:**
   - **Node.js:** Check if `node_modules` exists
     - If missing: Auto-run `npm install`
   - **Python:** Check if `.venv` exists
     - If missing: Auto-create and run `pip install -r requirements.txt`
   - ✅ Dependencies installed

3. **Configuration Check:**
   - Verify `.env` exists (or `.env.local`)
   - If missing: Auto-copy from `.env.example`
   - Compare keys between `.env` and `.env.example`
   - Warn about missing keys
   - ✅ Configuration complete

4. **Secrets Validation:**
   - For Supabase: Verify `SUPABASE_URL` and `SUPABASE_ANON_KEY` set
   - For other services: Check required API keys
   - ✅ Secrets configured

### 3. Baseline Integrity

**Verify codebase is healthy:**

1. **Tests:**
   - Run: `npm test` (or equivalent)
   - If tests fail: ❌ **ABORT** - Fix tests first
   - If pass: ✅ Proceed

2. **Build:**
   - Run: `npm run build` (or equivalent)
   - If build fails: ❌ **ABORT** - Fix build first
   - If succeeds: ✅ Proceed

3. **Linter:**
   - Run: `npm run lint`
   - If errors: ⚠️ Warn, consider auto-fixing
   - Auto-fix if possible: `npm run lint -- --fix`
   - See `standards/process/code-quality-linting-standards.md` Section 6.1

### 4. Task Understanding

**Before proceeding, verify:**

1. **Requirements Clear:**
   - Prompt if task is unclear: "Do you understand the goal?"
   - Suggest reviewing requirements if needed

2. **Documentation Review:**
   - Check `standards/` for relevant patterns
   - List applicable standards for the task

3. **Planning:**
   - Suggest creating TODO list for complex tasks

---

## Auto-Healing Actions

This rule will automatically:
- Install missing dependencies
- Create `.env` from `.env.example`
- Auto-fix linter errors (if fixable)
- Run these actions WITHOUT asking first (self-healing)

---

## Output Examples

### Success Case
```
✅ Pre-flight check complete – safe to start coding.

Summary:
- Git: Clean working tree, synced with origin/main
- Environment: Dependencies installed, .env configured
- Baseline: Tests pass, build succeeds, linter clean
- Task: Requirements clear, ready to proceed
```

### Failure Case
```
❌ Pre-flight check failed. Address these issues:

Issues:
- Git: Working tree has uncommitted changes
- Tests: 2 tests failing in auth.test.ts
- Linter: 5 errors in src/utils/helpers.ts

Cannot proceed until issues are resolved.
```

---

## Integration with Task Workflow

This rule integrates with `task-workflow.mdc`:
- Runs automatically at start of "Before Starting a Task" phase
- Prevents coding in broken environment
- Enables auto-healing for common issues

---

## Related Files

- **Rules:**
  - [task-workflow.mdc](./task-workflow.mdc) - Development workflow integration
  - [auto-heal.mdc](./auto-heal.mdc) - Auto-healing strategies
  - [linting-behavior.mdc](./linting-behavior.mdc) - Linting behavior
  - [../git/git-workflow-integration.mdc](../git/git-workflow-integration.mdc) - Git workflow coordination
  - [../git/git-branch-naming.mdc](../git/git-branch-naming.mdc) - Branch naming conventions
- **Standards:**
  - [code-quality-linting-standards.md](../../../standards/process/code-quality-linting-standards.md) - Linting requirements
  - [git-repository-standards.md](../../../standards/process/git-repository-standards.md) - Git workflow standards

---

## How to Use This Rule

**This rule applies automatically when starting new work.**

**Agents should:**
1. Detect when starting new task or significant work
2. Run pre-flight validation checks automatically
3. Auto-heal common issues (dependencies, .env, linter)
4. ABORT if critical issues found (failing tests, broken build)
5. Warn about non-critical issues (dirty git, TODOs)
6. Only proceed when environment is validated

**Trigger conditions:**
- User asks to "start task", "begin feature", "implement X"
- Agent detects start of work session
- Before making first significant code change
